# strm_muxr

> the script remuxes mp4/mkv files into mkv

## How to use

1. Install the [Node.js](https://nodejs.org/en/download/releases/) version `v16.13.1` as specified in `.nvmrc`. Also make sure `MKVToolNix` as well as `MP4Box` (e.g. inside `Yamb`) are installed on your system.

    *Note:* you can also install Node.js using `nvm` ([UNIX](https://github.com/nvm-sh/nvm), [Windows](https://github.com/coreybutler/nvm-windows)).

2. If on Windows, install [GitBash](https://gitforwindows.org/) as we will need it to run the remux process inside the bash shell.

    *Note:* during the install you may go with the default settings.

3. Then open the GitBash shell and clone this repository:
    ```
    git clone https://github.com/TomSssM/strm_muxr.git
    ```

    *Note:* you may also simply download the code from GitHub from the latest release instead of cloning, but bear in mind that in this case the `npm run clean` command is not going to work for you because it relies on git to work properly.

4. Create the directory `./content` inside the repository you just cloned (or downloaded) and copy the mp4/mkv video files you want to remux into it (see the details in the [Limitations](#limitations) section).

5. After this run `npm run build`.

6. Make sure to study all the warnings you may get from the "build" command.

    *Note:* in case you clean or close the terminal screen, you may find all the warnings duplicated in the `warnings.log.txt` file so you can always revisit and study them.

    *Note:* optionally, you may also check the generated `run.sh` script to make sure it has in it all the files you need to remux (*names* of video files as well as subtitle files if any).

7. Finally you may run `npm start`. Wait and relax, this process may take a while depending on the amount of data to remux.

    *Note:* all the mkv files are going to be remuxed into the `./out` directory.

8. Once the process is finished, you may check the remuxed files, for example open the `./out` folder in `MediaInfo` and / or click through the files manually, or start watching straight away!

## Description of commands

- `start` - runs the script generated by the "build" command thus remuxing all the video files from the `./content` directory into the `./out` directory.

- `build` - generates the script that remuxes mp4/mkv video files based on the contents of the `./content` directory.

- `clean` - removes all the files that were created after cloning the repository, handy for cleaning the workspace *after* you have copied the remuxed mkv files elsewhere.

## Limitations

- Supported video codec: `h264` (AVC)
- Supported audio codec: `eac3` (Enhanced AC3)
- Supported containers: `.mp4`, `.mkv`
- The script supports the following file structure:
    ```
    strm_muxr/
        content/                                  # video files (.mp4 or .mkv)
            sub/                                  # optional, subtitle files (any format supported by mkv)
                myVideoFile1_en.srt
                myVideoFile2_sub_[eng].srt
                ...
            myVideoFile1.mp4
            myVideoFile2.mkv
            ...
        out/                                      # remuxed .mkv video files, ready for watching
            myVideoFile1.mkv
            myVideoFile2.mkv
            ...
        ...
    ```
- Video file names should match subtitle file names in such a way that the name of a video file can be used as a prefix of the corresponding subtitle file, otherwise you get a warning. Embedded subtitles are not supported, only external in the `./content/sub` directory.

- In `.mp4` files, video should be track 1 and audio should be track 3. In `.mkv` files video should be track 1 and audio should be track 2. Also, there should be only 1 video track and only 1 English audio track.

## Disclaimer

As you can see from the [Limitations](#limitations) section, `strm_muxr` is a very simple script but its simplicity makes it very precise and safe. `strm_muxr` will fail and abort the entire process if codecs don't match for example because it supposes that you know what codecs you are working with and, if the input codecs don't match your expectations, then the script will tell you about it so you don't make a mistake or overlook anything.

I would also like to draw the reader's attention to the fact that despite its simplicity, `strm_muxr` gives its user a very flexible interface for processing any video files in bulk using the contemporary muxing tools (see the `./scripts` folder and how it is used by `run.sh`).

Therefore, you can also use it as a programmable interface for tools like `MKVToolNix` or `Yamb`. Just copy the command from the `MKVToolNix` GUI (or from `Yamb` log) and run it on multiple files via the `strm_muxr` infrastructure. Handy for simple but monotonous tasks like changing the order of audio roads in `.mkv` or `.mp4` video files and so on.
